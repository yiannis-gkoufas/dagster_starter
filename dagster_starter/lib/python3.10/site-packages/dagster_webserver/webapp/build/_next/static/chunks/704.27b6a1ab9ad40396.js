"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{26704:function(n,e,t){t.r(e),t.d(e,{CONCURRENCY_LIMIT_FRAGMENT:function(){return P},ConcurrencyLimits:function(){return ConcurrencyLimits},FREE_CONCURRENCY_SLOTS_FOR_RUN_MUTATION:function(){return q},INSTANCE_CONCURRENCY_LIMITS_QUERY:function(){return z}});var r=t(81862),i=t(58467),c=t(73235),o=t(22970),s=t(52322),l=t(40794),u=t(33379),a=t(60138),d=t(18399),x=t(63832),y=t(28888),h=t(17131),m=t(81308),f=t(92364),p=t(9001),j=t(71897),C=t(12084),g=t(54266),v=t(57830),_=t(37783),b=t(44678),O=t(10952),I=t(34822),L=t(2784),R=t(7267),S=t(19211),E=t(20775),N=t(91195),T=t(55237),k=t(68028),w=t(28252),K=t(6315),D=t(46253),F=t(74897),A=t(4120);function _templateObject(){var n=(0,c._)(["\n  fragment ConcurrencyLimitFragment on ConcurrencyKeyInfo {\n    concurrencyKey\n    slotCount\n    activeRunIds\n    activeSlotCount\n  }\n"]);return _templateObject=function(){return n},n}function _templateObject1(){var n=(0,c._)(["\n  query InstanceConcurrencyLimitsQuery {\n    instance {\n      id\n      info\n      supportsConcurrencyLimits\n      concurrencyLimits {\n        ...ConcurrencyLimitFragment\n      }\n    }\n  }\n\n  ","\n"]);return _templateObject1=function(){return n},n}function _templateObject2(){var n=(0,c._)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]);return _templateObject2=function(){return n},n}function _templateObject3(){var n=(0,c._)(["\n  mutation FreeConcurrencySlotsForRun($runId: String!) {\n    freeConcurrencySlotsForRun(runId: $runId)\n  }\n"]);return _templateObject3=function(){return n},n}function _templateObject4(){var n=(0,c._)(["\n  query RunsForConcurrencyKeyQuery($filter: RunsFilter, $limit: Int) {\n    pipelineRunsOrError(filter: $filter, limit: $limit) {\n      ... on Runs {\n        results {\n          id\n          ... on PipelineRun {\n            ...RunTableRunFragment\n          }\n        }\n      }\n      ... on PythonError {\n        ...PythonErrorFragment\n      }\n    }\n  }\n\n  ","\n  ","\n"]);return _templateObject4=function(){return n},n}var $=L.memo(function(){(0,k.Px)(),(0,w.j)("Concurrency");var n=(0,E.gV)().flagInstanceConcurrencyLimits,e=L.useContext(F.N).pageTitle,t=(0,l.a)(z,{notifyOnNetworkStatusChange:!0}),r=(0,T.C4)(t,T.dT),i=t.data,c=i?n?(0,s.jsx)(ConcurrencyLimits,{instanceConfig:i.instance.info,limits:i.instance.concurrencyLimits,hasSupport:i.instance.supportsConcurrencyLimits,refetch:t.refetch}):(0,s.jsx)(R.l_,{to:"/config"}):(0,s.jsx)(d.x,{padding:{vertical:64},children:(0,s.jsx)(x.$,{purpose:"section"})});return(0,s.jsxs)(y.T,{children:[(0,s.jsx)(h.m,{title:(0,s.jsx)(m.X6,{children:e}),tabs:(0,s.jsx)(A.Z,{tab:"concurrency",refreshState:r})}),c]})});e.default=$;var ConcurrencyLimits=function(n){var e=n.instanceConfig,t=n.hasSupport,r=n.limits,c=n.refetch,o=(0,i._)(L.useState(),2),l=o[0],u=o[1],a=(0,i._)(L.useState(void 0),2),x=a[0],y=a[1],h=(0,i._)(L.useState(void 0),2),m=h[0],_=h[1],b=L.useCallback(function(){y(void 0),_(void 0)},[_,y]),O=Object.fromEntries(r.map(function(n){return[n.concurrencyKey,n.slotCount]})),onAdd=function(){u({actionType:"add"})},onEdit=function(n){u({actionType:"edit",concurrencyKey:n,concurrencyLimit:O[n]})},onDelete=function(n){u({actionType:"delete",concurrencyKey:n})};return!t&&e&&e.includes("SqliteEventLogStorage")?(0,s.jsx)(d.x,{margin:24,children:(0,s.jsx)(f.t,{icon:"error",title:"No concurrency support",description:"This instance does not support global concurrency limits. You will need to configure a different storage implementation (e.g. Postgres/MySQL) to use this feature."})}):!1===t?(0,s.jsx)(d.x,{margin:24,children:(0,s.jsx)(f.t,{icon:"error",title:"No concurrency support",description:"This instance does not currently support global concurrency limits. You may need to run `dagster instance migrate` to add the necessary tables to your dagster storage to support this feature."})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(d.x,{children:[(0,s.jsx)(d.x,{flex:{justifyContent:"flex-end"},padding:16,children:(0,s.jsx)(p.zx,{intent:"primary",icon:(0,s.jsx)(j.JO,{name:"add_circle"}),onClick:function(){return onAdd()},children:"Add concurrency limit"})}),0===r.length?(0,s.jsx)(f.t,{icon:"error",title:"No concurrency limits",description:(0,s.jsxs)(s.Fragment,{children:["No concurrency limits have been configured for this instance.\xa0",(0,s.jsx)(C.Z,{onClick:function(){return onAdd()},children:"Add a concurrency limit"}),"."]})}):(0,s.jsxs)(g.i,{children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{style:{width:"260px"},children:"Concurrency key"}),(0,s.jsx)("th",{style:{width:"20%"},children:"Occupied slots"}),(0,s.jsx)("th",{style:{width:"20%"},children:"Total slots"}),(0,s.jsx)("th",{children:"Active runs"}),(0,s.jsx)("th",{})]})}),(0,s.jsx)("tbody",{children:r.map(function(n){return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:n.concurrencyKey}),(0,s.jsx)("td",{children:n.activeSlotCount}),(0,s.jsx)("td",{children:n.slotCount}),(0,s.jsx)("td",{children:0===n.activeRunIds.length?(0,s.jsx)(s.Fragment,{children:"â€”"}):(0,s.jsx)(v.V,{intent:"primary",interactive:!0,children:(0,s.jsxs)(C.Z,{onClick:function(){_(n.concurrencyKey),y(n.activeRunIds)},children:[n.activeRunIds.length," ",1===n.activeRunIds.length?"run":"runs"]})})}),(0,s.jsx)("td",{children:(0,s.jsx)(ConcurrencyLimitActionMenu,{concurrencyKey:n.concurrencyKey,onEdit:onEdit,onDelete:onDelete})})]},n.concurrencyKey)})})]})]}),(0,s.jsx)(AddConcurrencyLimitDialog,{open:(null==l?void 0:l.actionType)==="add",onClose:function(){return u(void 0)},onComplete:c}),(0,s.jsx)(DeleteConcurrencyLimitDialog,{concurrencyKey:l&&"delete"===l.actionType?l.concurrencyKey:"",open:(null==l?void 0:l.actionType)==="delete",onClose:function(){return u(void 0)},onComplete:c}),(0,s.jsx)(EditConcurrencyLimitDialog,{open:(null==l?void 0:l.actionType)==="edit",onClose:function(){return u(void 0)},onComplete:c,concurrencyKey:(null==l?void 0:l.actionType)==="edit"?l.concurrencyKey:""}),(0,s.jsx)(ConcurrencyRunsDialog,{title:(0,s.jsxs)("span",{children:["Active runs for ",(0,s.jsx)("strong",{children:m})]}),onClose:b,runIds:x})]})},ConcurrencyLimitActionMenu=function(n){var e=n.concurrencyKey,t=n.onDelete,r=n.onEdit;return(0,s.jsx)(_.J,{content:(0,s.jsxs)(b.v2,{children:[(0,s.jsx)(b.sN,{icon:"edit",text:"Edit",onClick:function(){return r(e)}}),(0,s.jsx)(b.sN,{icon:"delete",intent:"danger",text:"Delete",onClick:function(){return t(e)}})]}),position:"bottom-left",children:(0,s.jsx)(p.zx,{icon:(0,s.jsx)(j.JO,{name:"expand_more"})})})},isValidLimit=function(n){if(!n)return!1;var e=parseInt(n);return!isNaN(e)&&String(e)===n.trim()&&e>0&&e<1e3},AddConcurrencyLimitDialog=function(n){var e,t=n.open,c=n.onClose,l=n.onComplete,a=(0,i._)(L.useState(!1),2),x=a[0],y=a[1],h=(0,i._)(L.useState(""),2),m=h[0],f=h[1],j=(0,i._)(L.useState(""),2),C=j[0],g=j[1];L.useEffect(function(){f(""),g("")},[t]);var v=(0,i._)((0,u.D)(V),1)[0],_=(e=(0,r._)(function(){return(0,o.Jh)(this,function(n){switch(n.label){case 0:return y(!0),[4,v({variables:{concurrencyKey:C,limit:parseInt(m.trim())}})];case 1:return n.sent(),y(!1),l(),c(),[2]}})}),function(){return e.apply(this,arguments)});return(0,s.jsxs)(O.Vq,{isOpen:t,title:"Add concurrency limit",onClose:c,children:[(0,s.jsxs)(O.a7,{children:[(0,s.jsx)(d.x,{margin:{bottom:4},children:"Concurrency key:"}),(0,s.jsx)(d.x,{margin:{bottom:16},children:(0,s.jsx)(I.oi,{value:C||"",onChange:function(n){return g(n.target.value)},placeholder:"Concurrency key"})}),(0,s.jsx)(d.x,{margin:{bottom:4},children:"Concurrency limit (1-1000):"}),(0,s.jsx)(d.x,{children:(0,s.jsx)(I.oi,{value:m||"",onChange:function(n){return f(n.target.value)},placeholder:"1 - 1000"})})]}),(0,s.jsxs)(O.cN,{children:[(0,s.jsx)(p.zx,{intent:"none",onClick:c,children:"Cancel"}),(0,s.jsx)(p.zx,{intent:"primary",onClick:_,disabled:!isValidLimit(m.trim())||!C||x,children:x?"Adding...":"Add limit"})]})]})},EditConcurrencyLimitDialog=function(n){var e,t=n.concurrencyKey,c=n.open,l=n.onClose,a=n.onComplete,x=(0,i._)(L.useState(!1),2),y=x[0],h=x[1],f=(0,i._)(L.useState(""),2),j=f[0],C=f[1];L.useEffect(function(){C("")},[c]);var g=(0,i._)((0,u.D)(V),1)[0],v=(e=(0,r._)(function(){return(0,o.Jh)(this,function(n){switch(n.label){case 0:return h(!0),[4,g({variables:{concurrencyKey:t,limit:parseInt(j.trim())}})];case 1:return n.sent(),h(!1),a(),l(),[2]}})}),function(){return e.apply(this,arguments)}),_=(0,s.jsxs)(s.Fragment,{children:["Edit ",(0,s.jsx)(m.fv,{children:t})]});return(0,s.jsxs)(O.Vq,{isOpen:c,title:_,onClose:l,children:[(0,s.jsxs)(O.a7,{children:[(0,s.jsx)(d.x,{margin:{bottom:4},children:"Concurrency key:"}),(0,s.jsx)(d.x,{margin:{bottom:16},children:(0,s.jsx)("strong",{children:t})}),(0,s.jsx)(d.x,{margin:{bottom:4},children:"Concurrency limit (1-1000):"}),(0,s.jsx)(d.x,{children:(0,s.jsx)(I.oi,{value:j||"",onChange:function(n){return C(n.target.value)},placeholder:"1 - 1000"})})]}),(0,s.jsxs)(O.cN,{children:[(0,s.jsx)(p.zx,{intent:"none",onClick:l,children:"Close"}),y?(0,s.jsx)(p.zx,{intent:"primary",disabled:!0,children:"Updating..."}):(0,s.jsx)(p.zx,{intent:"primary",onClick:v,disabled:!isValidLimit(j.trim()),children:"Update limit"})]})]})},DeleteConcurrencyLimitDialog=function(n){var e,t=n.concurrencyKey,c=n.open,l=n.onClose,a=n.onComplete,d=(0,i._)(L.useState(!1),2),x=d[0],y=d[1],h=(0,i._)((0,u.D)(V),1)[0],f=(e=(0,r._)(function(){return(0,o.Jh)(this,function(n){switch(n.label){case 0:return y(!0),[4,h({variables:{concurrencyKey:t,limit:0}})];case 1:return n.sent(),y(!1),a(),l(),[2]}})}),function(){return e.apply(this,arguments)}),j=(0,s.jsxs)(s.Fragment,{children:["Delete ",(0,s.jsx)(m.fv,{children:t})]});return(0,s.jsxs)(O.Vq,{isOpen:c,title:j,onClose:l,children:[(0,s.jsxs)(O.a7,{children:["Delete concurrency limit\xa0",(0,s.jsx)("strong",{children:t}),"?"]}),(0,s.jsxs)(O.cN,{children:[(0,s.jsx)(p.zx,{intent:"none",onClick:l,children:"Close"}),x?(0,s.jsx)(p.zx,{intent:"danger",disabled:!0,children:"Deleting..."}):(0,s.jsx)(p.zx,{intent:"danger",onClick:f,children:"Delete limit"})]})]})},ConcurrencyRunsDialog=function(n){var e=n.runIds,t=n.onClose,c=n.title,a=(0,l.a)(J,{variables:{limit:25,filter:{runIds:e||[]}},skip:!e||!e.length}).data,y=(0,i._)((0,u.D)(q),1)[0],h=L.useCallback(function(n){return K.cv.has(n.status)?[(0,s.jsx)(b.sN,{icon:"status",text:"Free concurrency slots for run",onClick:(0,r._)(function(){var e;return(0,o.Jh)(this,function(r){switch(r.label){case 0:return[4,y({variables:{runId:n.id}})];case 1:if(!(null===(e=r.sent().data)||void 0===e?void 0:e.freeConcurrencySlotsForRun))return[3,3];return[4,(0,S.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slots"})];case 2:r.sent(),r.label=3;case 3:return t(),[2]}})})},"free-concurrency-slots")]:[]},[y,t]);return(0,s.jsxs)(O.Vq,{isOpen:!!e&&e.length>0,title:c,onClose:t,style:{minWidth:"400px",maxWidth:"calc(100% - 40px)",width:"fit-content"},children:[(0,s.jsx)(d.x,{padding:{vertical:16},children:a?"Runs"===a.pipelineRunsOrError.__typename?(0,s.jsx)("div",{style:{overflow:"auto"},children:(0,s.jsx)(D.AL,{runs:a.pipelineRunsOrError.results,additionalActionsForRun:h})}):(0,s.jsxs)(d.x,{padding:{vertical:64},children:[(0,s.jsx)(f.t,{icon:"error",title:"Query Error",description:"PythonError"===a.pipelineRunsOrError.__typename?a.pipelineRunsOrError.message:"There was a problem querying for these runs."}),";"]}):(0,s.jsx)(d.x,{padding:{vertical:64},children:(0,s.jsx)(x.$,{purpose:"section"})})}),(0,s.jsx)(O.cN,{children:(0,s.jsx)(p.zx,{intent:"none",onClick:t,children:"Close"})})]})},P=(0,a.Ps)(_templateObject()),z=(0,a.Ps)(_templateObject1(),P),V=(0,a.Ps)(_templateObject2()),q=(0,a.Ps)(_templateObject3()),J=(0,a.Ps)(_templateObject4(),D.ZZ,N.B)},4120:function(n,e,t){t.d(e,{Z:function(){return InstanceTabs}});var r=t(52322),i=t(18399),c=t(56024),o=t(2784),s=t(20775),l=t(55237),u=t(71897),a=t(86412),d=t(29255),x=t(77334),y=o.memo(function(){var n=o.useContext(d.Z).daemons;return n?(0,r.jsx)(x.a,{content:n.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,r.jsx)(u.JO,{name:"warning",color:a.w.Yellow500})}):null}),h=t(43180),m=t(63832),f=o.memo(function(n){var e=n.placeholder,t=o.useContext(d.Z).codeLocations;return t?"spinner"===t.type?(0,r.jsx)(h.u,{content:t.content,placement:"bottom",children:(0,r.jsx)(m.$,{purpose:"body-text",fillColor:a.w.Gray300})}):(0,r.jsx)(x.a,{content:t.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,r.jsx)(u.JO,{name:"warning",color:a.w.Yellow500})}):e?(0,r.jsx)("div",{style:{width:"16px"}}):null}),p=t(40049),j=t(74897),C=t(78945),InstanceTabs=function(n){var e=n.refreshState,t=n.tab,u=o.useContext(j.N).healthTitle,a=(0,C._)(),d=(0,s.gV)().flagInstanceConcurrencyLimits;return(0,r.jsxs)(i.x,{flex:{direction:"row",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,r.jsxs)(c.mQ,{selectedTabId:t,children:[(0,r.jsx)(p.f,{id:"locations",title:"Code locations",to:"/locations",icon:(0,r.jsx)(f,{placeholder:!1})}),(0,r.jsx)(p.f,{id:"health",title:u,to:"/health",icon:(0,r.jsx)(y,{})}),a&&d?(0,r.jsx)(p.f,{id:"concurrency",title:"Concurrency limits",to:"/concurrency"}):null,a?(0,r.jsx)(p.f,{id:"config",title:"Configuration",to:"/config"}):null]}),e?(0,r.jsx)(i.x,{padding:{bottom:8},children:(0,r.jsx)(l.xi,{refreshState:e})}):null]})}},78945:function(n,e,t){t.d(e,{_:function(){return useCanSeeConfig}});var r=t(73235),i=t(40794),c=t(60138);function _templateObject(){var n=(0,r._)(["\n  query InstanceConfigHasInfo {\n    instance {\n      id\n      hasInfo\n    }\n  }\n"]);return _templateObject=function(){return n},n}var useCanSeeConfig=function(){var n=(0,i.a)(o).data;return!!(null==n?void 0:n.instance.hasInfo)},o=(0,c.Ps)(_templateObject())}}]);
//# sourceMappingURL=704.27b6a1ab9ad40396.js.map